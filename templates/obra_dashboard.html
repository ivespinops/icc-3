{% extends "base.html" %}

{% block title %}Dashboard - {{ obra.nombre_obra }} - Constructora ICC{% endblock %}

{% block content %}
<div class="welcome">
    <h2>Dashboard - {{ obra.nombre_obra }}</h2>
    <p>Centro de Costo: {{ obra.centro_costo }}</p>
</div>

<div class="card">
    <h3>Informaci√≥n General</h3>
    <div class="obra-info">
        <p><strong>Nombre de la Obra:</strong> {{ obra.nombre_obra }}</p>
        <p><strong>Centro de Costo:</strong> {{ obra.centro_costo }}</p>
        <p><strong>Administrador:</strong> {{ obra.administrador_nombre }}</p>
        <p><strong>Estado:</strong> <span style="color: #28a745;">Activa</span></p>
    </div>
</div>

<div class="card">
    <h3>M√©tricas Principales</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px;">

        <div style="background: #e3f2fd; border-radius: 8px; padding: 20px; text-align: center;">
            <h4 style="color: #1976d2; margin: 0 0 10px 0;">Facturas Totales</h4>
            <p style="font-size: 24px; font-weight: bold; color: #1976d2; margin: 0;" id="totalFacturas">-</p>
        </div>

        <div style="background: #e8f5e8; border-radius: 8px; padding: 20px; text-align: center;">
            <h4 style="color: #388e3c; margin: 0 0 10px 0;">Facturas Pagadas</h4>
            <p style="font-size: 24px; font-weight: bold; color: #388e3c; margin: 0;" id="facturasPagadas">-</p>
        </div>

        <div style="background: #fff3e0; border-radius: 8px; padding: 20px; text-align: center;">
            <h4 style="color: #f57c00; margin: 0 0 10px 0;">Facturas Pendientes</h4>
            <p style="font-size: 24px; font-weight: bold; color: #f57c00; margin: 0;" id="facturasPendientes">-</p>
        </div>

        <div style="background: #fce4ec; border-radius: 8px; padding: 20px; text-align: center;">
            <h4 style="color: #c2185b; margin: 0 0 10px 0;">Monto Total</h4>
            <p style="font-size: 20px; font-weight: bold; color: #c2185b; margin: 0;" id="montoTotal">-</p>
        </div>

    </div>
</div>

<div class="card">
    <h3>Acciones R√°pidas</h3>
    <div style="display: flex; flex-wrap: wrap; gap: 15px; margin-top: 15px;">
        <a href="/obras/{{ obra.id }}/facturas" style="color: #fff; background: #007bff; padding: 10px 20px; text-decoration: none; border-radius: 5px;">
            üìÑ Ver Facturas
        </a>
        <a href="/obras/{{ obra.id }}/reportes" style="color: #fff; background: #28a745; padding: 10px 20px; text-decoration: none; border-radius: 5px;">
            üìä Generar Reporte
        </a>
        <a href="/pagos?obra_id={{ obra.id }}" style="color: #fff; background: #6f42c1; padding: 10px 20px; text-decoration: none; border-radius: 5px;">
            üí∞ Gesti√≥n de Pagos
        </a>
    </div>
</div>

<div class="card">
    <h3>Actividad Reciente</h3>
    <div id="actividadReciente">
        <p style="color: #666; font-style: italic;">Cargando actividad reciente...</p>
    </div>
</div>

<div class="card">
    <h3>Navegaci√≥n</h3>
    <p>‚Ä¢ Volver a <a href="/obras/{{ obra.id }}" style="color: #0066cc;">{{ obra.nombre_obra }}</a></p>
    <p>‚Ä¢ Ir al <a href="/obras" style="color: #0066cc;">M√≥dulo de Obras</a></p>
    <p>‚Ä¢ Ir al <a href="/dashboard" style="color: #0066cc;">Dashboard Principal</a></p>
</div>

<script>
// Cargar m√©tricas de la obra
async function cargarMetricas() {
    try {
        // Simular datos - aqu√≠ deber√≠as hacer llamadas reales a tu API
        document.getElementById('totalFacturas').textContent = '45';
        document.getElementById('facturasPagadas').textContent = '32';
        document.getElementById('facturasPendientes').textContent = '13';
        document.getElementById('montoTotal').textContent = '$125.8M';

        // Cargar actividad reciente
        const actividadDiv = document.getElementById('actividadReciente');
        actividadDiv.innerHTML = `
            <div style="border-left: 3px solid #007bff; padding-left: 15px; margin-bottom: 10px;">
                <p style="margin: 0; font-weight: bold;">Factura #1234 procesada</p>
                <p style="margin: 0; font-size: 12px; color: #666;">Hace 2 horas</p>
            </div>
            <div style="border-left: 3px solid #28a745; padding-left: 15px; margin-bottom: 10px;">
                <p style="margin: 0; font-weight: bold;">Pago autorizado por $50.000</p>
                <p style="margin: 0; font-size: 12px; color: #666;">Hace 5 horas</p>
            </div>
            <div style="border-left: 3px solid #ffc107; padding-left: 15px;">
                <p style="margin: 0; font-weight: bold;">Reporte mensual generado</p>
                <p style="margin: 0; font-size: 12px; color: #666;">Ayer</p>
            </div>
        `;
    } catch (error) {
        console.error('Error cargando m√©tricas:', error);
    }
}

// Cargar m√©tricas al inicializar la p√°gina
document.addEventListener('DOMContentLoaded', cargarMetricas);
</script>

{% endblock %}